<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Farcaster Reminder Mini App</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Farcaster SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@farcaster/js@latest"></script>

    <style>
      :root {
        --bg: #fdfdfd;
        --card: #ffffff;
        --border: #ddd;
        --text-main: #111;
        --text-dim: #666;
        --accent: #000;
        --radius-lg: 16px;
        --radius-md: 10px;
        --radius-sm: 6px;
        --font: -apple-system,BlinkMacSystemFont,"Inter","SF Pro Text","Roboto","Segoe UI",system-ui,sans-serif;
      }

      body {
        background-color: var(--bg);
        color: var(--text-main);
        font-family: var(--font);
        margin: 0;
        padding: 24px 16px 80px;
        display: flex;
        justify-content: center;
      }

      .app-shell {
        width: 100%;
        max-width: 480px;
      }

      .header-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 20px 16px;
        text-align: center;
        box-shadow: 0 12px 28px rgba(0,0,0,0.04);
      }

      .emoji-badge {
        font-size: 28px;
        line-height: 1;
        display: inline-block;
        margin-bottom: 8px;
      }

      .title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-main);
        margin: 0 0 6px;
      }

      .subtitle {
        font-size: 14px;
        line-height: 1.4;
        color: var(--text-dim);
        margin: 0;
      }

      .note-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        box-shadow: 0 12px 28px rgba(0,0,0,0.04);
        margin-top: 16px;
        padding: 16px;
      }

      .field-label {
        font-size: 13px;
        font-weight: 500;
        color: var(--text-main);
        margin-bottom: 6px;
        display: flex;
        justify-content: space-between;
      }

      .field-hint {
        font-size: 12px;
        color: var(--text-dim);
        font-weight: 400;
      }

      textarea.note-input {
        width: 100%;
        background: #fafafa;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 12px;
        min-height: 80px;
        font-family: inherit;
        font-size: 14px;
        color: var(--text-main);
        resize: none;
        outline: none;
      }

      textarea.note-input:focus {
        border-color: var(--accent);
        background: #fff;
      }

      .time-row {
        display: flex;
        gap: 12px;
        margin-top: 16px;
      }

      .time-field {
        flex: 1;
      }

      input.time-input,
      input.date-input {
        width: 100%;
        box-sizing: border-box;
        background: #fafafa;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 10px 12px;
        font-size: 14px;
        color: var(--text-main);
        outline: none;
      }

      input.time-input:focus,
      input.date-input:focus {
        border-color: var(--accent);
        background: #fff;
      }

      .save-btn-wrap {
        margin-top: 20px;
        text-align: center;
      }

      button.save-btn {
        -webkit-appearance: none;
        appearance: none;
        background: var(--accent);
        color: #fff;
        border: 0;
        border-radius: var(--radius-md);
        font-size: 15px;
        font-weight: 600;
        line-height: 1.2;
        padding: 12px 16px;
        min-width: 140px;
        cursor: pointer;
      }

      button.save-btn:active {
        opacity: 0.85;
        transform: scale(.99);
      }

      .result-card {
        background: #fafafa;
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        margin-top: 20px;
        padding: 12px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 13px;
        line-height: 1.4;
        color: var(--text-main);
        white-space: pre-wrap;
        word-break: break-word;
      }

      .footer-hint {
        margin-top: 16px;
        font-size: 12px;
        line-height: 1.4;
        color: var(--text-dim);
        text-align: center;
      }
    </style>

    <script>
      async function sendPayRequest() {
        const noteText = document.getElementById("noteInput").value.trim();
        const dateVal  = document.getElementById("dateInput").value;
        const timeVal  = document.getElementById("timeInput").value;

        // frontend tarafƒ±nda basic validation
        if (!noteText) {
          showResult({ ok: false, error: "L√ºtfen hatƒ±rlatma metni gir." });
          return;
        }
        if (!dateVal || !timeVal) {
          showResult({ ok: false, error: "L√ºtfen tarih ve saat se√ß." });
          return;
        }

        // ==== √ñDEME / TX TASLAƒûI ====
        // Bu endpoint (api/pay.js) h√¢l√¢ aynƒ± ≈üekilde sahte tx taslaƒüƒ± veriyor.
        try {
          const body = {
            fid: 1234,
            usdAmount: 0.05,
            ethAddress: "0xABC01234567890abcdef1234567890ABCDEF12"
          };

          const res = await fetch("/api/pay", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
          });

          const data = await res.json();

          // burada not+zaman bilgisini da g√∂sterelim
          data.noteText = noteText;
          data.remindAt = `${dateVal} ${timeVal}`;

          showResult(data);
        } catch (err) {
          showResult({ ok: false, error: "ƒ∞stek ba≈üarƒ±sƒ±z: " + err.message });
        }
      }

      function showResult(data) {
        const box = document.getElementById("resultBox");
        box.textContent = JSON.stringify(data, null, 2);
      }

      // -------- Farcaster Mini App Ready --------
      window.onload = () => {
        // Farcaster Preview Tool "Ready not called" uyarƒ±sƒ±nƒ± susturmak i√ßin:
        if (window.sdk && window.sdk.actions && typeof window.sdk.actions.ready === "function") {
          window.sdk.actions.ready();
        }
      };
    </script>
  </head>

  <body>
    <div class="app-shell">
      <!-- √úst kart / ba≈ülƒ±k -->
      <section class="header-card">
        <div class="emoji-badge">üîî</div>
        <h1 class="title">Farcaster Reminder Mini App</h1>
        <p class="subtitle">
          Bu mini app sana bir hatƒ±rlatma notu ve zamanƒ± kaydetmek i√ßin tasarlandƒ±.
          Kaydet dediƒüinde zincire g√∂nderilecek √∂deme taslaƒüƒ±nƒ± da hazƒ±rlarƒ±z.
        </p>
      </section>

      <!-- Not alanƒ± -->
      <section class="note-card">

        <div class="field-label">
          <span>Hatƒ±rlatma Notu</span>
          <span class="field-hint">√∂rn. ‚Äú12:00 toplantƒ±yƒ± unutma‚Äù</span>
        </div>
        <textarea
          id="noteInput"
          class="note-input"
          placeholder="Ne i√ßin ping almak istiyorsun?"
        ></textarea>

        <div class="time-row">
          <div class="time-field">
            <div class="field-label">
              <span>Tarih</span>
            </div>
            <input
              id="dateInput"
              class="date-input"
              type="date"
            />
          </div>

          <div class="time-field">
            <div class="field-label">
              <span>Saat</span>
            </div>
            <input
              id="timeInput"
              class="time-input"
              type="time"
            />
          </div>
        </div>

        <div class="save-btn-wrap">
          <button class="save-btn" onclick="sendPayRequest()">
            Kaydet
          </button>
        </div>
      </section>

      <!-- Sonu√ß / debug -->
      <section class="result-card" id="resultBox">
        {"ok":true,"message":"Hen√ºz bir istek g√∂ndermedin."}
      </section>

      <div class="footer-hint">
        Bu ekran sadece demo. ‚ÄúKaydet‚Äù dediƒüinde backend‚Äôden
        sahte bir tx taslaƒüƒ± d√∂nd√ºr√ºyoruz.<br/>
        Ger√ßek √∂deme zincire g√∂nderilmez.
      </div>
    </div>
  </body>
</html>

