<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farcaster Reminder</title>

  <!-- Farcaster Mini App SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@farcaster/js@latest"></script>

  <style>
    :root {
      --bg-color: #faf5e9;
      --card-bg: #ffffff;
      --card-border: #e5dfcf;
      --text-main: #1a1a1a;
      --text-dim: #6b6b6b;
      --accent: #000000;
      --radius-lg: 12px;
      --radius-sm: 8px;
      --shadow-card: 0 16px 32px rgba(0,0,0,0.08);
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    body {
      background-color: var(--bg-color);
      margin: 0;
      padding: 24px;
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    /* Outer card */
    .app-card {
      width: 100%;
      max-width: 400px;
      background-color: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--radius-lg);
      padding: 24px 20px 32px;
      box-shadow: var(--shadow-card);
    }

    /* Header */
    .header-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
      text-align: center;
    }

    .emoji-icon {
      font-size: 28px;
      line-height: 1;
      margin-bottom: 12px;
    }

    .title-text {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
      color: var(--text-main);
    }

    /* Field group wrapper */
    .field-block {
      margin-bottom: 16px;
    }

    .field-row {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
      margin-bottom: 6px;
      display: flex;
      align-items: baseline;
      gap: 6px;
      flex-wrap: wrap;
    }

    label .hint {
      font-weight: 400;
      color: var(--text-dim);
      font-size: 12px;
    }

    /* Inputs */
    textarea,
    input[type="text"],
    input[type="date"],
    input[type="time"] {
      width: 100%;
      font-size: 14px;
      color: var(--text-main);
      background-color: #fff;
      border: 1px solid var(--card-border);
      border-radius: var(--radius-sm);
      padding: 12px 40px 12px 12px; /* room for icon on the right */
      line-height: 1.4;
      outline: none;
    }

    textarea:focus,
    input:focus {
      border-color: #c9c3b2;
      box-shadow: 0 0 0 3px rgba(0,0,0,0.06);
    }

    textarea {
      min-height: 90px;
      resize: none;
    }

    /* Date/time wrapper with icon */
    .input-with-icon {
      position: relative;
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
    }

    .input-with-icon input {
      padding-right: 36px;
    }

    .input-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 16px;
      color: var(--text-dim);
      pointer-events: none;
    }

    /* Save button */
    .save-row {
      display: flex;
      justify-content: center;
      margin: 20px 0 24px;
    }

    .save-btn {
      background-color: var(--accent);
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: var(--radius-sm);
      padding: 14px 24px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .save-btn:active {
      transform: scale(0.98);
    }

    /* Error message (hidden by default) */
    .error-box {
      display: none;
      background-color: #fff1f1;
      color: #b00020;
      border: 1px solid #f5c2c7;
      border-radius: var(--radius-sm);
      font-size: 13px;
      padding: 10px 12px;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    .error-box.show {
      display: block;
    }

    /* Saved Reminders section */
    .saved-section {
      background-color: #fff;
      border: 1px solid var(--card-border);
      border-radius: var(--radius-sm);
      padding: 16px;
    }

    .saved-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      margin: 0 0 12px;
    }

    .reminder-card {
      border: 1px solid var(--card-border);
      border-radius: var(--radius-sm);
      padding: 12px;
      font-size: 13px;
      line-height: 1.4;
      background-color: #fff;
      margin-bottom: 10px;
    }

    .reminder-top {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 8px;
    }

    .reminder-note {
      color: var(--text-main);
      font-weight: 500;
      word-break: break-word;
    }

    .reminder-datetime {
      color: var(--text-main);
      font-size: 13px;
    }

    .reminder-payment {
      font-size: 12px;
      color: var(--text-dim);
    }

    @media (min-width: 390px) {
      .reminder-top {
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
      }
      .reminder-datetime {
        text-align: right;
        white-space: nowrap;
      }
    }
  </style>
</head>
<body>
  <div class="app-card">
    <!-- Header -->
    <div class="header-area">
      <div class="emoji-icon">üîî</div>
      <h1 class="title-text">Farcaster Reminder</h1>
    </div>

    <!-- Reminder text field -->
    <div class="field-block">
      <label for="noteInput">
        Reminder Note
        <span class="hint">ex. "Team call at 12:00"</span>
      </label>
      <textarea id="noteInput" placeholder="Write your reminder..."></textarea>
    </div>

    <!-- Date + Time row -->
    <div class="field-row">
      <div class="input-with-icon">
        <label for="dateInput">
          Date <span class="hint">(dd.mm.yyyy)</span>
        </label>
        <input id="dateInput" type="date" />
        <div class="input-icon">üìÖ</div>
      </div>

      <div class="input-with-icon">
        <label for="timeInput">
          Time <span class="hint">(hh:mm)</span>
        </label>
        <input id="timeInput" type="time" />
        <div class="input-icon">‚è∞</div>
      </div>
    </div>

    <!-- Save button -->
    <div class="save-row">
      <button id="saveBtn" class="save-btn">Save</button>
    </div>

    <!-- Error box -->
    <div id="errorBox" class="error-box"></div>

    <!-- Saved reminders list -->
    <div class="saved-section">
      <h2 class="saved-title">Saved Reminders</h2>
      <div id="remindersList"></div>
    </div>
  </div>

  <script>
    // --- Farcaster SDK "ready" ping so Mini App preview stops warning
    window.onload = () => {
      if (window.sdk?.actions) {
        window.sdk.actions.ready?.();
      }
    };

    // Local in-memory list of reminders
    const reminders = [];

    // DOM refs
    const noteInput = document.getElementById('noteInput');
    const dateInput = document.getElementById('dateInput');
    const timeInput = document.getElementById('timeInput');
    const saveBtn   = document.getElementById('saveBtn');
    const errorBox  = document.getElementById('errorBox');
    const listEl    = document.getElementById('remindersList');

    // helper: format datetime nicely
    function formatDateTime(isoDateStr, isoTimeStr) {
      // combine into single ISO-like string for display
      if (!isoDateStr || !isoTimeStr) return '';

      // Native input[type=date] gives "yyyy-mm-dd"
      // Native input[type=time] gives "HH:MM"
      // We'll show "yyyy-mm-dd HH:MM" (or could localize later)
      return isoDateStr + ' ' + isoTimeStr;
    }

    // fake payment draft builder
    function buildPaymentDraft() {
      // This is intentionally static for now.
      // We'll show ~0.000017 ETH (~$0.05)
      return {
        ethNeeded: "0.000017",
        usdApprox: "0.05"
      };
    }

    function renderReminders() {
      listEl.innerHTML = '';

      reminders.forEach(rem => {
        const div = document.createElement('div');
        div.className = 'reminder-card';

        div.innerHTML = `
          <div class="reminder-top">
            <div class="reminder-note">${escapeHtml(rem.note)}</div>
            <div class="reminder-datetime">${escapeHtml(rem.dateTimeDisplay)}</div>
          </div>
          <div class="reminder-payment">
            Payment draft: ${rem.payment.ethNeeded} ETH (~$${rem.payment.usdApprox})
          </div>
        `;

        listEl.prepend(div); // newest on top
      });
    }

    // tiny escape to avoid HTML injection in note
    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    async function handleSave() {
      const note = noteInput.value.trim();
      const dVal = dateInput.value; // "yyyy-mm-dd"
      const tVal = timeInput.value; // "HH:MM"

      // basic validation
      if (!note) {
        showError('Please enter a reminder note.');
        return;
      }
      if (!dVal) {
        showError('Please pick a date.');
        return;
      }
      if (!tVal) {
        showError('Please pick a time.');
        return;
      }

      hideError();

      // build payment draft (fake / static for now)
      const draft = buildPaymentDraft();

      // build entire reminder object in-memory
      const combinedDisplay = formatDateTime(dVal, tVal);

      const newReminder = {
        note,
        date: dVal,
        time: tVal,
        dateTimeDisplay: combinedDisplay,
        payment: draft
      };

      // push to local list
      reminders.push(newReminder);

      // re-render list
      renderReminders();

      // clear form
      noteInput.value = '';
      dateInput.value = '';
      timeInput.value = '';
    }

    function showError(msg) {
      errorBox.textContent = msg;
      errorBox.classList.add('show');
    }

    function hideError() {
      errorBox.classList.remove('show');
    }

    // wire button
    saveBtn.addEventListener('click', handleSave);

    // initial render (empty)
    renderReminders();
  </script>
</body>
</html>


