<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Farcaster Reminder Mini App</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Farcaster SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@farcaster/js@latest"></script>

    <style>
  /* Genel sayfa stili */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    background-color: #fdf8e7; /* yumuşak krem */
    margin: 0;
    padding: 24px;
    color: #1a1a1a;
    display: flex;
    justify-content: center;
  }

  /* Ana kart */
  .card {
    background: #ffffff;
    width: 100%;
    max-width: 420px;
    border-radius: 16px;
    box-shadow:
      0 14px 30px rgba(0,0,0,0.08),
      0 4px 8px rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.06);
    padding: 20px 20px 16px;
    box-sizing: border-box;
  }

  /* Başlık alanı */
  .header {
    text-align: center;
    margin-bottom: 20px;
  }

  .emoji-badge {
    font-size: 28px;
    line-height: 1;
    display: inline-block;
    margin-bottom: 8px;
  }

  .app-title {
    font-size: 18px;
    font-weight: 600;
    color: #000;
    margin: 0 0 6px;
  }

  .app-desc {
    font-size: 13px;
    line-height: 1.4;
    color: #444;
    margin: 0;
  }

  /* Alan etiketleri */
  .section-label-row {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: #777;
    margin-bottom: 6px;
    font-weight: 500;
  }
  .section-label-row .hint {
    color: #777;
    font-style: italic;
  }

  /* Not kutusu */
  textarea {
    width: 100%;
    min-height: 70px;
    resize: none;
    box-sizing: border-box;
    border: 1px solid rgba(0,0,0,0.12);
    border-radius: 10px;
    background-color: #fff;
    font-size: 14px;
    line-height: 1.4;
    padding: 12px 14px;
    color: #000;
    outline: none;
  }

  textarea::placeholder {
    color: #999;
  }

  /* Tarih + Saat satırı */
  .row-inline {
    display: flex;
    gap: 12px;
    margin-top: 16px;
    margin-bottom: 16px;
  }

  .field-group {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .field-label {
    font-size: 12px;
    color: #555;
    font-weight: 500;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .input-like {
    width: 100%;
    border: 1px solid rgba(0,0,0,0.12);
    border-radius: 10px;
    background-color: #fff;
    padding: 10px 12px;
    font-size: 14px;
    color: #000;
    line-height: 1.3;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }

  .input-like input {
    border: none;
    outline: none;
    background: transparent;
    width: 100%;
    font-size: 14px;
    color: #000;
    padding: 0;
  }

  .input-like input::placeholder {
    color: #777;
  }

  /* Kaydet butonu */
  .save-row {
    display: flex;
    justify-content: center;
  }

  #saveBtn {
    appearance: none;
    border: none;
    outline: none;
    border-radius: 10px;
    background-color: #000;
    color: #fff;
    font-size: 15px;
    font-weight: 600;
    line-height: 1.2;
    padding: 12px 20px;
    min-width: 120px;
    cursor: pointer;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  }

  #saveBtn:active {
    transform: scale(0.98);
  }

  /* Sonuç kutusu (kullanıcıya mesaj gösterdiğimiz yer) */
  .result-box {
    margin-top: 16px;
    background: rgba(0,0,0,0.03);
    border: 1px solid rgba(0,0,0,0.07);
    border-radius: 10px;
    padding: 12px 14px;
    font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
    font-size: 12px;
    color: #333;
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* Not: preview tool için body zaten dar bir container içinde.
     normal browser'da ortalanmış görünsün diye yukarıdaki flex var */
</style>


    <script>
      async function sendPayRequest() {
        const noteText = document.getElementById("noteInput").value.trim();
        const dateVal  = document.getElementById("dateInput").value;
        const timeVal  = document.getElementById("timeInput").value;

        // frontend tarafında basic validation
        if (!noteText) {
          showResult({ ok: false, error: "Lütfen hatırlatma metni gir." });
          return;
        }
        if (!dateVal || !timeVal) {
          showResult({ ok: false, error: "Lütfen tarih ve saat seç." });
          return;
        }

        // ==== ÖDEME / TX TASLAĞI ====
        // Bu endpoint (api/pay.js) hâlâ aynı şekilde sahte tx taslağı veriyor.
        try {
          const body = {
            fid: 1234,
            usdAmount: 0.05,
            ethAddress: "0xABC01234567890abcdef1234567890ABCDEF12"
          };

          const res = await fetch("/api/pay", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
          });

          const data = await res.json();

          // burada not+zaman bilgisini da gösterelim
          data.noteText = noteText;
          data.remindAt = `${dateVal} ${timeVal}`;

          showResult(data);
        } catch (err) {
          showResult({ ok: false, error: "İstek başarısız: " + err.message });
        }
      }

      function showResult(data) {
        const box = document.getElementById("resultBox");
        box.textContent = JSON.stringify(data, null, 2);
      }

      // -------- Farcaster Mini App Ready --------
      window.onload = () => {
        // Farcaster Preview Tool "Ready not called" uyarısını susturmak için:
        if (window.sdk && window.sdk.actions && typeof window.sdk.actions.ready === "function") {
          window.sdk.actions.ready();
        }
      };
    </script>
  </head>

  <body>
    <div class="app-shell">
      <!-- Üst kart / başlık -->
      <section class="header-card">
        <div class="emoji-badge">🔔</div>
        <h1 class="title">Farcaster Reminder Mini App</h1>
        <p class="subtitle">
          Bu mini app sana bir hatırlatma notu ve zamanı kaydetmek için tasarlandı.
          Kaydet dediğinde zincire gönderilecek ödeme taslağını da hazırlarız.
        </p>
      </section>

      <!-- Not alanı -->
      <section class="note-card">

        <div class="field-label">
          <span>Hatırlatma Notu</span>
          <span class="field-hint">örn. “12:00 toplantıyı unutma”</span>
        </div>
        <textarea
          id="noteInput"
          class="note-input"
          placeholder="Ne için ping almak istiyorsun?"
        ></textarea>

        <div class="time-row">
          <div class="time-field">
            <div class="field-label">
              <span>Tarih</span>
            </div>
            <input
              id="dateInput"
              class="date-input"
              type="date"
            />
          </div>

          <div class="time-field">
            <div class="field-label">
              <span>Saat</span>
            </div>
            <input
              id="timeInput"
              class="time-input"
              type="time"
            />
          </div>
        </div>

        <div class="save-btn-wrap">
          <button class="save-btn" onclick="sendPayRequest()">
            Kaydet
          </button>
        </div>
      </section>

      <!-- Sonuç / debug -->
      <section class="result-card" id="resultBox">
        {"ok":true,"message":"Henüz bir istek göndermedin."}
      </section>

      <div class="footer-hint">
        Bu ekran sadece demo. “Kaydet” dediğinde backend’den
        sahte bir tx taslağı döndürüyoruz.<br/>
        Gerçek ödeme zincire gönderilmez.
      </div>
    </div>
  </body>
</html>

