<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Farcaster Reminder Mini App</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Farcaster SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@farcaster/js@latest"></script>

    <style>
  /* Genel sayfa stili */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    background-color: #fdf8e7; /* yumuÅŸak krem */
    margin: 0;
    padding: 24px;
    color: #1a1a1a;
    display: flex;
    justify-content: center;
  }

  /* Ana kart */
  .card {
    background: #ffffff;
    width: 100%;
    max-width: 420px;
    border-radius: 16px;
    box-shadow:
      0 14px 30px rgba(0,0,0,0.08),
      0 4px 8px rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.06);
    padding: 20px 20px 16px;
    box-sizing: border-box;
  }

  /* BaÅŸlÄ±k alanÄ± */
  .header {
    text-align: center;
    margin-bottom: 20px;
  }

  .emoji-badge {
    font-size: 28px;
    line-height: 1;
    display: inline-block;
    margin-bottom: 8px;
  }

  .app-title {
    font-size: 18px;
    font-weight: 600;
    color: #000;
    margin: 0 0 6px;
  }

  .app-desc {
    font-size: 13px;
    line-height: 1.4;
    color: #444;
    margin: 0;
  }

  /* Alan etiketleri */
  .section-label-row {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: #777;
    margin-bottom: 6px;
    font-weight: 500;
  }
  .section-label-row .hint {
    color: #777;
    font-style: italic;
  }

  /* Not kutusu */
  textarea {
    width: 100%;
    min-height: 70px;
    resize: none;
    box-sizing: border-box;
    border: 1px solid rgba(0,0,0,0.12);
    border-radius: 10px;
    background-color: #fff;
    font-size: 14px;
    line-height: 1.4;
    padding: 12px 14px;
    color: #000;
    outline: none;
  }

  textarea::placeholder {
    color: #999;
  }

  /* Tarih + Saat satÄ±rÄ± */
  .row-inline {
    display: flex;
    gap: 12px;
    margin-top: 16px;
    margin-bottom: 16px;
  }

  .field-group {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .field-label {
    font-size: 12px;
    color: #555;
    font-weight: 500;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .input-like {
    width: 100%;
    border: 1px solid rgba(0,0,0,0.12);
    border-radius: 10px;
    background-color: #fff;
    padding: 10px 12px;
    font-size: 14px;
    color: #000;
    line-height: 1.3;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }

  .input-like input {
    border: none;
    outline: none;
    background: transparent;
    width: 100%;
    font-size: 14px;
    color: #000;
    padding: 0;
  }

  .input-like input::placeholder {
    color: #777;
  }

  /* Kaydet butonu */
  .save-row {
    display: flex;
    justify-content: center;
  }

  #saveBtn {
    appearance: none;
    border: none;
    outline: none;
    border-radius: 10px;
    background-color: #000;
    color: #fff;
    font-size: 15px;
    font-weight: 600;
    line-height: 1.2;
    padding: 12px 20px;
    min-width: 120px;
    cursor: pointer;
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  }

  #saveBtn:active {
    transform: scale(0.98);
  }

  /* SonuÃ§ kutusu (kullanÄ±cÄ±ya mesaj gÃ¶sterdiÄŸimiz yer) */
  .result-box {
    margin-top: 16px;
    background: rgba(0,0,0,0.03);
    border: 1px solid rgba(0,0,0,0.07);
    border-radius: 10px;
    padding: 12px 14px;
    font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
    font-size: 12px;
    color: #333;
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* Not: preview tool iÃ§in body zaten dar bir container iÃ§inde.
     normal browser'da ortalanmÄ±ÅŸ gÃ¶rÃ¼nsÃ¼n diye yukarÄ±daki flex var */
</style>


    <script>
      async function sendPayRequest() {
        const noteText = document.getElementById("noteInput").value.trim();
        const dateVal  = document.getElementById("dateInput").value;
        const timeVal  = document.getElementById("timeInput").value;

        // frontend tarafÄ±nda basic validation
        if (!noteText) {
          showResult({ ok: false, error: "LÃ¼tfen hatÄ±rlatma metni gir." });
          return;
        }
        if (!dateVal || !timeVal) {
          showResult({ ok: false, error: "LÃ¼tfen tarih ve saat seÃ§." });
          return;
        }

        // ==== Ã–DEME / TX TASLAÄI ====
        // Bu endpoint (api/pay.js) hÃ¢lÃ¢ aynÄ± ÅŸekilde sahte tx taslaÄŸÄ± veriyor.
        try {
          const body = {
            fid: 1234,
            usdAmount: 0.05,
            ethAddress: "0xABC01234567890abcdef1234567890ABCDEF12"
          };

          const res = await fetch("/api/pay", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
          });

          const data = await res.json();

          // burada not+zaman bilgisini da gÃ¶sterelim
          data.noteText = noteText;
          data.remindAt = `${dateVal} ${timeVal}`;

          showResult(data);
        } catch (err) {
          showResult({ ok: false, error: "Ä°stek baÅŸarÄ±sÄ±z: " + err.message });
        }
      }

      function showResult(data) {
        const box = document.getElementById("resultBox");
        box.textContent = JSON.stringify(data, null, 2);
      }

      // -------- Farcaster Mini App Ready --------
      window.onload = () => {
        // Farcaster Preview Tool "Ready not called" uyarÄ±sÄ±nÄ± susturmak iÃ§in:
        if (window.sdk && window.sdk.actions && typeof window.sdk.actions.ready === "function") {
          window.sdk.actions.ready();
        }
      };
    </script>
  </head>

  <body>
    <div class="app-shell">
      <!-- Ãœst kart / baÅŸlÄ±k -->
      <section class="header-card">
        <div class="emoji-badge">ğŸ””</div>
        <h1 class="title">Farcaster Reminder Mini App</h1>
        <p class="subtitle">
          Bu mini app sana bir hatÄ±rlatma notu ve zamanÄ± kaydetmek iÃ§in tasarlandÄ±.
          Kaydet dediÄŸinde zincire gÃ¶nderilecek Ã¶deme taslaÄŸÄ±nÄ± da hazÄ±rlarÄ±z.
        </p>
      </section>

      <!-- Not alanÄ± -->
      <section class="note-card">

        <div class="field-label">
          <span>HatÄ±rlatma Notu</span>
          <span class="field-hint">Ã¶rn. â€œ12:00 toplantÄ±yÄ± unutmaâ€</span>
        </div>
        <textarea
          id="noteInput"
          class="note-input"
          placeholder="Ne iÃ§in ping almak istiyorsun?"
        ></textarea>

        <div class="time-row">
          <div class="time-field">
            <div class="field-label">
              <span>Tarih</span>
            </div>
            <input
              id="dateInput"
              class="date-input"
              type="date"
            />
          </div>

          <div class="time-field">
            <div class="field-label">
              <span>Saat</span>
            </div>
            <input
              id="timeInput"
              class="time-input"
              type="time"
            />
          </div>
        </div>

        <div class="save-btn-wrap">
          <button class="save-btn" onclick="sendPayRequest()">
            Kaydet
          </button>
        </div>
      </section>

      <!-- SonuÃ§ / debug -->
      <section class="result-card" id="resultBox">
        {"ok":true,"message":"HenÃ¼z bir istek gÃ¶ndermedin."}
      </section>

      <div class="footer-hint">
        Bu ekran sadece demo. â€œKaydetâ€ dediÄŸinde backendâ€™den
        sahte bir tx taslaÄŸÄ± dÃ¶ndÃ¼rÃ¼yoruz.<br/>
        GerÃ§ek Ã¶deme zincire gÃ¶nderilmez.
      </div>
    </div>
  </body>
</html>

